<div style="
  font-family: 'Poppins', sans-serif;
  color: #333;
  max-width: 100%;
">

    <!-- Naamveld -->
    <label for="nickname" style="
    display: block;
    margin-bottom: 6px;
    font-weight: 500;
    font-size: 20px;
    color: #000000
  ">
        Naam of nickname <span style="color:#555555; font-weight: 400">(deze wordt zichtbaar in het leaderboard)</span>
    </label>

    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 16px;">
        <input type="text" id="nickname" name="nickname" placeholder="Bijv. TimoTheTank" style="
      flex: 1;
      padding: 12px 16px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-family: inherit;
    ">
        <button id="checkNicknameBtn" style="
      background-color: #FF630D;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s ease;
      font-family: inherit;
    ">Check</button>
    </div>

    <!-- Status message -->
    <p id="nicknameStatus" style="font-size: 16px; margin-top: 4px;"></p>

    <!-- Referral-link en kopieerknop -->
    <div id="referralSection" style="display: none; margin-top: 24px;">
        <label for="referral" style="
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      font-size: 20px;
      color: #000000
    ">
            Jouw persoonlijke link
        </label>

        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <input type="text" id="referral" readonly style="
        flex: 1;
        min-width: 200px;
        padding: 12px 16px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-family: inherit;
        background: #fff;
      ">
            <button id="copyBtn" style="
        background-color: #FF630D;
        color: white;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-size: 16px;
        cursor: pointer;
        transition: background 0.2s ease;
        font-family: inherit;
      ">Kopieer</button>
        </div>

        <!-- Uitlegtekst -->
        <p style="font-size: 18px; color: #555555; margin-top: 12px;">
            Deel deze link met je gymmaatjes â€“ voor elke bestelling via jouw link verdien je een loterij-ticket.
        </p>
    </div>
</div>

<script>
    // Get userId from URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('userId');

    if (!userId) {
        alert("Geen userId gevonden in de URL!");
    }

    const checkBtn = document.getElementById('checkNicknameBtn');
    const nicknameInput = document.getElementById('nickname');
    const statusEl = document.getElementById('nicknameStatus');
    const referralSection = document.getElementById('referralSection');
    const referralInput = document.getElementById('referral');
    const copyBtn = document.getElementById('copyBtn');

    checkBtn.addEventListener('click', async () => {
        const nickname = nicknameInput.value.trim();
        if (!nickname) {
            statusEl.textContent = "Voer een nickname in.";
            statusEl.style.color = "red";
            return;
        }

        try {
            const res = await fetch('/add-nickname', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, nickname })
            });

            if (!res.ok) {
                const errorMsg = await res.text();
                statusEl.textContent = errorMsg || "Er is een fout opgetreden.";
                statusEl.style.color = "red";
                referralSection.style.display = "none";
                return;
            }

            const data = await res.json();
            statusEl.textContent = `Nickname "${data.nickname}" is geregistreerd!`;
            statusEl.style.color = "green";

            referralInput.value = `https://gieriggroeien.nl/r/${data.nickname}`;
            referralSection.style.display = "block";

        } catch (err) {
            console.error(err);
            statusEl.textContent = "Er is een fout opgetreden.";
            statusEl.style.color = "red";
        }
    });

    copyBtn.addEventListener('click', () => {
        referralInput.select();
        document.execCommand('copy');
        copyBtn.textContent = "Gekopieerd!";
        setTimeout(() => (copyBtn.textContent = "Kopieer"), 1500);
    });
</script>